
# Redis Strings

## Redis 문자열에 대한 소개

Redis 문자열은 텍스트, 직렬화된 객체, 바이너리 배열 등을 포함하는 바이트 시퀀스를 저장합니다. 이와 같이 문자열은 Redis 키에 사용할 수 있는 가장 기본적인 형태의 값입니다. 문자열은 주로 캐싱에 이용되지만, 사용자가 카운터를 구현하거나 비트 연산을 수행할 수 있도록 해주는 추가적인 기능들도 지원합니다.

Redis에서 키는 문자열이며, 값도 문자열 타입을 사용하므로 문자열에 문자열을 매핑하는 구조가 됩니다. 문자열 타입은 HTML 조각이나 전체 페이지를 캐싱하는 등 다양한 상황에서 유용하게 사용됩니다.

```redis
SET bike:1 Deimos
OK
GET bike:1
"Deimos"
```

`SET` 명령어와 `GET` 명령어를 통해 문자열 값을 설정하고 조회할 수 있습니다.  
`SET` 명령어는 키에 기존 값이 존재하거나, 값이 문자열이 아니더라도 기존 값을 대체하여 새 값을 할당합니다. 즉, `SET` 명령어는 값을 할당하는 작업을 수행합니다.

값이 문자열이라면(바이너리 데이터를 포함하여) 어떤 형태든 저장이 가능하며, 예를 들어 JPEG 이미지도 저장할 수 있습니다. 단, 값의 크기는 512MB를 초과할 수 없습니다.

`SET` 명령어는 추가적인 인자 옵션도 제공합니다. 예를 들어, 키가 이미 존재하는 경우 `SET`이 실패하게 하거나, 키가 존재해야만 성공하도록 설정할 수 있습니다.

```redis
SET bike:1 bike NX
(nil)
SET bike:1 bike XX
OK
```

문자열을 조작하는 다양한 명령어가 존재합니다. 예를 들어, `GETSET` 명령어는 키를 새 값으로 설정하고 기존 값을 반환합니다. 이 명령어는 새로운 방문자가 들어올 때마다 `INCR`을 사용하여 Redis 키를 증가시키는 시스템에서 활용할 수 있습니다.  
이 정보를 매 시간 단 한 건도 누락 없이 수집하고자 할 때, `GETSET` 명령어를 사용하여 키를 `"0"`으로 초기화하고 기존 값을 반환받을 수 있습니다.

단일 명령어로 여러 키를 설정하거나 조회하는 기능은 지연 시간을 줄이는 데 유용합니다. 이 때문에 Redis는 `MSET`과 `MGET` 명령어를 제공합니다:

```redis
MSET bike:1 "Deimos" bike:2 "Ares" bike:3 "Vanth"
OK
MGET bike:1 bike:2 bike:3
1) "Deimos"
2) "Ares"
3) "Vanth"
```

## 카운터로서의 문자열

문자열은 Redis의 기본 값이지만, 다양한 연산을 수행할 수 있습니다. 그중 하나가 **원자적 증가(atomic increment)** 입니다.

```redis
SET total_crashes 0
OK
INCR total_crashes
(integer) 1
INCRBY total_crashes 10
(integer) 11
```

`INCR` 명령어는 문자열 값을 정수로 해석한 뒤 1씩 증가시키고, 증가된 값을 새 값으로 설정합니다.  
`INCRBY`, `DECR`, `DECRBY` 등 유사한 명령어들도 있으며, 내부적으로는 동일한 명령어가 약간 다르게 동작하는 방식입니다.

### 원자적 증가란?

`INCR`이 원자적이라는 것은, 여러 클라이언트가 동시에 같은 키에 대해 `INCR` 명령을 실행하더라도 **경쟁 상태(race condition)** 가 발생하지 않는다는 의미입니다.

예를 들어, 클라이언트 1과 2가 동시에 `"10"`이라는 값을 읽은 후 각각 `11`로 증가시키고 설정하는 일이 발생하지 않습니다.  
`INCR`는 읽기-증가-설정의 과정을 하나의 원자적 작업으로 처리하기 때문에, 최종 값은 항상 `12`가 됩니다. 이 작업 중에는 다른 클라이언트의 명령이 개입할 수 없습니다.

## Limits

- 단일 Redis 문자열은 최대 **512MB**까지 저장할 수 있습니다.

## Basic Commands

### Getting and Setting Strings

- `SET` : 문자열 값을 저장합니다.
- `SETNX` : 키가 존재하지 않을 경우에만 값을 저장합니다. (락 구현에 유용함)
- `GET` : 문자열 값을 조회합니다.
- `MGET` : 여러 개의 키 값을 한 번에 조회합니다.

### Managing Counters

- `INCR` : 값을 원자적으로 1 증가시킵니다.
- `INCRBY` : 값을 지정한 수만큼 원자적으로 증가시킵니다. (음수일 경우 감소)
- `INCRBYFLOAT` : 소숫점 값을 가지는 카운터를 조작할 수 있습니다.

### Bitwise Operations

문자열에서 비트 연산을 수행하려면 Redis의 **bitmap 자료형**을 참조합니다.  
모든 문자열 명령어 목록은 Redis 공식 문서에서 확인할 수 있습니다.

## Performance

- 대부분의 문자열 명령어는 시간 복잡도 **O(1)** 로 매우 효율적으로 작동합니다.
- 다만, `SUBSTR`, `GETRANGE`, `SETRANGE` 등은 **O(n)** 복잡도를 가지므로, 큰 문자열을 다룰 때 성능 이슈가 발생할 수 있습니다.

## Alternatives

- 직렬화된 문자열로 구조화된 데이터를 저장하려는 경우, Redis의 **해시(Hash)** 또는 **JSON** 자료형을 사용하는 것을 고려할 수 있습니다.

## Learn More

- **Redis Strings Explained** : Redis 문자열에 대한 짧고 종합적인 비디오 강의입니다.
- **Redis University의 RU101** : Redis 문자열과 기본 개념에 대해 더 깊이 있게 학습할 수 있는 무료 강의입니다.
